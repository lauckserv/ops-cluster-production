postiz:
  enabled: true
  global: 
    fullnameOverride: postiz
  controllers:
    postiz:
      type: deployment
      strategy: Recreate
      containers:
        postiz: 
          image:
            repository: ghcr.io/gitroomhq/postiz-app
            tag: latest
            pullPolicy: IfNotPresent
          env:
            # === Required Settings ===
            MAIN_URL: "https://postiz.lauckserv.com"
            FRONTEND_URL: "https://postiz.lauckserv.com"
            NEXT_PUBLIC_BACKEND_URL: "https://postiz.lauckserv.com/api"
            JWT_SECRET:
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: jwt-secret
            DATABASE_URL:
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: POSTGRES_URL
            REDIS_URL: "redis://postiz-redis:6379"
            BACKEND_INTERNAL_URL: "http://localhost:3000"
            TEMPORAL_ADDRESS: "postiz-temporal:7233"
            IS_GENERAL: "true"
            DISABLE_REGISTRATION: "true"
            
            # === Storage Settings ===
            STORAGE_PROVIDER: "local" 
            UPLOAD_DIRECTORY: "/uploads"
            NEXT_PUBLIC_UPLOAD_DIRECTORY: "/uploads"
            
            # === Cloudflare (R2) Settings ===
            CLOUDFLARE_ACCOUNT_ID: ""
            CLOUDFLARE_ACCESS_KEY: ""
            CLOUDFLARE_SECRET_ACCESS_KEY: ""
            CLOUDFLARE_BUCKETNAME: ""
            CLOUDFLARE_BUCKET_URL: ""
            CLOUDFLARE_REGION: "auto"
            
            # === Social Media API Settings ===
            X_API_KEY: ""
            X_API_SECRET: ""
            LINKEDIN_CLIENT_ID: ""
            LINKEDIN_CLIENT_SECRET: ""
            REDDIT_CLIENT_ID: ""
            REDDIT_CLIENT_SECRET: ""
            GITHUB_CLIENT_ID: ""
            GITHUB_CLIENT_SECRET: ""
            BEEHIIVE_API_KEY: ""
            BEEHIIVE_PUBLICATION_ID: ""
            THREADS_APP_ID: ""
            THREADS_APP_SECRET: ""
            FACEBOOK_APP_ID:
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: FACEBOOK_APP_ID
            FACEBOOK_APP_SECRET:
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: FACEBOOK_APP_SECRET
            YOUTUBE_CLIENT_ID: ""
            YOUTUBE_CLIENT_SECRET: ""
            TIKTOK_CLIENT_ID: ""
            TIKTOK_CLIENT_SECRET: ""
            PINTEREST_CLIENT_ID: ""
            PINTEREST_CLIENT_SECRET: ""
            DRIBBBLE_CLIENT_ID: ""
            DRIBBBLE_CLIENT_SECRET: ""
            DISCORD_CLIENT_ID: ""
            DISCORD_CLIENT_SECRET: ""
            DISCORD_BOT_TOKEN_ID: ""
            SLACK_ID: ""
            SLACK_SECRET: ""
            SLACK_SIGNING_SECRET: ""
            MASTODON_URL: "https://mastodon.social"
            MASTODON_CLIENT_ID: ""
            MASTODON_CLIENT_SECRET: ""
            
            # === OAuth & Authentik Settings ===
            NEXT_PUBLIC_POSTIZ_OAUTH_DISPLAY_NAME: "Microsoft Entra"
            NEXT_PUBLIC_POSTIZ_OAUTH_LOGO_URL: "https://raw.githubusercontent.com/walkxcode/dashboard-icons/master/png/authentik.png"
            POSTIZ_GENERIC_OAUTH: "true"
            POSTIZ_OAUTH_URL:
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: ENTRA_OAUTH_URL
            POSTIZ_OAUTH_AUTH_URL:
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: ENTRA_OAUTH_AUTH_URL
            POSTIZ_OAUTH_TOKEN_URL:
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: ENTRA_OAUTH_TOKEN_URL
            POSTIZ_OAUTH_USERINFO_URL:
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: ENTRA_OAUTH_USERINFO_URL
            POSTIZ_OAUTH_CLIENT_ID: 
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: ENTRA_OAUTH_CLIENT_ID
            POSTIZ_OAUTH_CLIENT_SECRET: 
              valueFrom:
                secretKeyRef:
                  name: postiz-secrets
                  key: ENTRA_OAUTH_CLIENT_SECRET
            
            # === Sentry Settings ===
            NEXT_PUBLIC_SENTRY_DSN: ""
            SENTRY_SPOTLIGHT: "0"
            
            # === Misc Settings ===
            OPENAI_API_KEY: ""
            NEXT_PUBLIC_DISCORD_SUPPORT: ""
            NEXT_PUBLIC_POLOTNO: ""
            API_LIMIT: "30"
            
            # === Payment / Stripe Settings ===
            FEE_AMOUNT: "0.05"
            STRIPE_PUBLISHABLE_KEY: ""
            STRIPE_SECRET_KEY: ""
            STRIPE_SIGNING_KEY: ""
            STRIPE_SIGNING_KEY_CONNECT: ""
            
            # === Developer Settings ===
            NX_ADD_PLUGINS: "false"
            
            # === Short Link Service Settings (Optional) ===
            # DUB_TOKEN: ""
            # DUB_API_ENDPOINT: "https://api.dub.co"
            # DUB_SHORT_LINK_DOMAIN: "dub.sh"
            # SHORT_IO_SECRET_KEY: ""
            # KUTT_API_KEY: ""
            # KUTT_API_ENDPOINT: "https://kutt.it/api/v2"
            # KUTT_SHORT_LINK_DOMAIN: "kutt.it"
            # LINK_DRIP_API_KEY: ""
            # LINK_DRIP_API_ENDPOINT: "https://api.linkdrip.com/v1/"
            # LINK_DRIP_SHORT_LINK_DOMAIN: "dripl.ink"
    
    redis:
      replicas: 1
      type: deployment
      strategy: Recreate
      containers:
        redis:
          image:
            repository: redis
            tag: "7.2"
            pullPolicy: IfNotPresent  
    
    postgres:
      type: deployment
      replicas: 1
      strategy: Recreate
      containers:
        postgres:
          image:
            repository: postgres
            tag: "17-alpine"
            pullPolicy: IfNotPresent
          envFrom:
          - secretRef:
              name: postiz-secrets
          env:
          - name: POSTGRES_PORT
            value: 5432
          - name: POSTGRES_DB
            value: postiz
          - name: PGDATA
            value: /var/lib/postgresql/data/pgdata

    # Temporal Stack
    temporal-elasticsearch:
      type: deployment
      replicas: 1
      strategy: Recreate
      containers:
        temporal-elasticsearch:
          image:
            repository: elasticsearch
            tag: "7.17.27"
            pullPolicy: IfNotPresent
          env:
            - name: cluster.routing.allocation.disk.threshold_enabled
              value: "true"
            - name: cluster.routing.allocation.disk.watermark.low
              value: "512mb"
            - name: cluster.routing.allocation.disk.watermark.high
              value: "256mb"
            - name: cluster.routing.allocation.disk.watermark.flood_stage
              value: "128mb"
            - name: discovery.type
              value: "single-node"
            - name: ES_JAVA_OPTS
              value: "-Xms256m -Xmx256m"
            - name: xpack.security.enabled
              value: "false"

    temporal-postgresql:
      type: deployment
      replicas: 1
      strategy: Recreate
      containers:
        temporal-postgresql:
          image:
            repository: postgres
            tag: "17-alpine"
            pullPolicy: IfNotPresent
          envFrom:
          - secretRef:
              name: postiz-secrets
          env:
          - name: PGDATA
            value: /var/lib/postgresql/data/pgdata

    temporal:
      type: deployment
      replicas: 1
      strategy: Recreate
      containers:
        temporal:
          image:
            repository: temporalio/auto-setup
            tag: "1.28.1"
            pullPolicy: IfNotPresent
          env:
            - name: DB_PORT
              value: "5432"
            - name: POSTGRES_SEEDS
              value: "postiz-temporal-postgresql"
            - name: DYNAMIC_CONFIG_FILE_PATH
              value: "config/dynamicconfig/development-sql.yaml"
            - name: ENABLE_ES
              value: "true"
            - name: ES_SEEDS
              value: "postiz-temporal-elasticsearch"
            - name: ES_VERSION
              value: "v7"
            - name: "cassandra.enabled"
              value: "false"
            - name: TEMPORAL_NAMESPACE
              value: "default"
          envFrom:
          - secretRef:
              name: postiz-secrets

    temporal-ui:
      type: deployment
      replicas: 1
      strategy: Recreate
      containers:
        temporal-ui:
          image:
            repository: temporalio/ui
            tag: "2.34.0"
            pullPolicy: IfNotPresent
          env:
            - name: TEMPORAL_ADDRESS
              value: "postiz-temporal:7233"
            - name: TEMPORAL_CORS_ORIGINS
              value: "http://127.0.0.1:3000"

  persistence:
    uploads:
      enabled: true
      size: 2Gi
      storageClass: nfs-client
      accessMode: ReadWriteOnce
      advancedMounts:
        postiz:
          postiz:
            - path: /uploads
              readOnly: false
    database:
      enabled: true
      size: 5Gi
      storageClass: nfs-nosquash
      accessMode: ReadWriteOnce
      advancedMounts:
        postgres:
          postgres:
            - path: /var/lib/postgresql/data
              readOnly: false
      retain: true
    temporal-elasticsearch-data:
      enabled: true
      size: 1Gi
      storageClass: nfs-client
      accessMode: ReadWriteOnce
      advancedMounts:
        temporal-elasticsearch:
          temporal-elasticsearch:
            - path: /usr/share/elasticsearch/data
              readOnly: false
      retain: true
    temporal-postgresql-data:
      enabled: true
      size: 2Gi
      storageClass: nfs-nosquash
      accessMode: ReadWriteOnce
      advancedMounts:
        temporal-postgresql:
          temporal-postgresql:
            - path: /var/lib/postgresql/data
              readOnly: false
      retain: true

  service:
    postiz:
      enabled: true
      primary: true
      controller: postiz
      ports:
        http:
          port: 5000
    
    postgres:
      controller: postgres
      type: ClusterIP
      ports:
        http:
          port: 5432
    
    redis:
      controller: redis
      type: ClusterIP
      ports:
        http:
          port: 6379

    temporal-elasticsearch:
      controller: temporal-elasticsearch
      type: ClusterIP
      ports:
        http:
          port: 9200

    temporal-postgresql:
      controller: temporal-postgresql
      type: ClusterIP
      ports:
        http:
          port: 5432

    temporal:
      controller: temporal
      type: ClusterIP
      ports:
        http:
          port: 7233

    temporal-ui:
      controller: temporal-ui
      type: ClusterIP
      ports:
        http:
          port: 8080
    
  ingress:
    postiz:
      enabled: true
      className: nginx
      annotations:
        kubernetes.io/ingress.class: nginx
        nginx.ingress.kubernetes.io/proxy-body-size: 500M
        nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
        nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
      hosts:
        - host: postiz.lauckserv.com
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: postiz
                port: http

    temporal-ui:
      enabled: true
      className: nginx
      annotations:
        kubernetes.io/ingress.class: nginx
        nginx.ingress.kubernetes.io/proxy-body-size: 500M
        nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
        nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
      hosts:
        - host: postiz-temporal.lauckserv.com
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: temporal-ui
                port: http
